# change the prefix from 'C-b' to 'C-h'
# (remap capslock to CTRL for easy access)
unbind C-b
# set -g prefix M-m
# bind M-m send-prefix
set -g prefix C-e
bind C-e send-prefix

# start with window 1 (instead of 0)
set -g base-index 1

# start with pane 1
set -g pane-base-index 1

# split panes using | and -, make sure they open in the same path
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

unbind '"'
unbind %

# open new windows in the current path
bind c new-window -c "#{pane_current_path}"

# reload config file
bind r source-file ~/.tmux.conf \; display-message "Reloaded config."

# unbind p
# bind p previous-window

# shorten command delay
set -sg escape-time 1

# don't rename windows automatically
set -g allow-rename off

# mouse control (clickable windows, panes, resizable panes)
set -g mouse on

# Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# enable vi mode keys
set-window-option -g mode-keys vi

# set default terminal mode to 256 colors
set -g default-terminal "screen-256color"
set-option -ga terminal-overrides ",*256col*:Tc"
# set-option -sa terminal-overrides ',screen-256color:RGB'

# Pass zsh cursor shape to tmux
# sync from https://github.com/neovim/neovim/issues/5096
set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q' # this is for the cursor shape

# present a menu of URLs to open from the visible pane. sweet.
bind u capture-pane \;\
    save-buffer /tmp/tmux-buffer \;\
    split-window -l 10 "urlview /tmp/tmux-buffer"

######################
### DESIGN CHANGES ###
######################

# loud or quiet?
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none


######################
###     Other      ###
######################

# switch window
bind-key -n F4 previous-window
bind-key -n F5 next-window
bind -n M-j previous-window
bind -n M-k next-window

# Select pane and windows
bind -r C-[ previous-window
bind -r C-] next-window
bind -r [ select-pane -t :.-
bind -r ] select-pane -t :.+
bind -r Tab last-window   # cycle thru MRU tabs
bind -r C-o swap-pane -D
bind -r w select-pane -t :.+

bind p paste-buffer
bind C-p choose-buffer

 # trigger copy mode
bind -n M-y copy-mode

# split panes using v and h, make sure they open in the same path
bind v split-window -h -c "#{pane_current_path}"
bind h split-window -v -c "#{pane_current_path}"

# nvim setting
set-option -g focus-events on

# fix pbcopy/pbpaste
# if 'command -v reattach-to-user-namespace >/dev/null' \
#     'set -gq @osx-pasteboard true'
#
# if 'tmux show -gv @osx-clipboard' \
#     'set -g default-command "reattach-to-user-namespace -l $SHELL"'

# copy to system clipboard
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'
# bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xsel -i -b'
# bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'xsel -i -b'

# yank="~/local/bin/yank.sh"
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "$yank" \; display-message "Copied to clipboard."
# bind -T copylmode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "$yank" \; display-message "Copied to clipboard."

# check tmux version https://stackoverflow.com/a/36953319
run-shell "bash verify_tmux_version.sh"

# https://sunaku.github.io/tmux-yank-osc52.html#create-a-bin-yank-script
# transfer copied text to attached terminal with yank
bind-key -T copy-mode-vi enter send-keys -X copy-pipe-and-cancel 'yank > #{pane_tty}'
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'yank > #{pane_tty}'

# transfer most-recently copied text to attached terminal with yank
# bind-key -n M-y run-shell 'tmux save-buffer - | yank > #{pane_tty}'

# transfer previously copied text (chosen from a menu) to attached terminal
# bind-key -n M-Y choose-buffer 'run-shell "tmux save-buffer -b \"%%%\" - | yank > #{pane_tty}"'

# if tmux_version >= '3.3'
# pass "Ptmux;" escape sequences through to the terminal
set-window-option -g allow-passthrough on

# tpm
# Note: Press prefix + I (capital i, as in Install) to fetch the plugin.

# set -g @plugin 'catppuccin/tmux'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'samoshkin/tmux-plugin-sysstat'

# set -g @catppuccin_flavour 'latte' # or frappe, macchiato, mocha
# set -g @plugin 'maxpetretta/tmux-monokai-pro'
# set -g @plugin 'loctvl842/monokai-pro.tmux'

# set -g status-right "#{sysstat_cpu} | #{sysstat_mem} | #{sysstat_swap} | #{sysstat_loadavg} | #[fg=cyan]#(echo $USER)#[default]@#H"
#
# set -g status-interval 5
# set -g status-right '#(tmux-mem-cpu-load --interval 5 -m 1) | %m/%d %H:%M '
# set -g status-right-length 250
# set -g status-left-length 20

# setting from https://chadaustin.me/2024/02/tmux-config/
# Improve the status bar. The default status bar places the session ID
# to the left, but I rarely have more than one session. I do, however,
# care about the hostname, so hostname:session_id followed by month,
# day, and current time is useful context for the lower right.
# set -g status-left " "
# set -g status-right-length 60
set -g status-right " #h:#S  %H:%M "

# Modus Themes for Tmux
# Auto generated with https://github.com/miikanissi/modus-themes.nvim/blob/master/lua/modus-themes/extras/tmux.lua
set-option -g status-position "bottom"
set-option -g status-style bg='#cab9b2,fg=#0a0a0a'
set-option -g status-left '#[bg=#cab9b2,fg=#0a0a0a,bold]#{?client_prefix,,  tmux  }#[bg=#3548cf,fg=#efe9dd,bold]#{?client_prefix,  tmux  ,}'
# set-option -g status-right '#S'
set-option -g window-status-format ' #I:#W '
set-option -g window-status-current-format '#[bg=#3548cf,fg=#efe9dd] #I:#W#{?window_zoomed_flag, ïž’ , }'

run '~/.tmux/plugins/tpm/tpm'
